<div class="profile-container">
  <!-- Message de chargement -->
  <div *ngIf="loading && !employe" class="text-center py-5">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-2 text-muted">Chargement du profil...</p>
  </div>

  <!-- Carte de profil -->
  <div *ngIf="employe || !loading" class="profile-card">
    <div class="profile-banner"></div>
    <div class="profile-header">
      <div class="position-relative">
        <img 
          [src]="photoPreview || employe?.photoProfil || 'assets/images/LUM3.jpg'" 
          [alt]="displayName" 
          class="profile-avatar-xl"
        />
        <button 
          class="btn btn-sm btn-primary position-absolute bottom-0 end-0 rounded-circle"
          style="width: 36px; height: 36px; padding: 0;"
          (click)="editSection('photo')"
          title="Changer la photo"
        >
          <i class="bi bi-pencil"></i>
        </button>
        <input 
          #photoInput
          type="file"
          accept="image/*"
          style="display: none;"
          (change)="onPhotoSelected($event)"
        />
        <!-- Modal pour éditer la photo -->
        <div *ngIf="editingSection === 'photo'" class="modal fade show d-block" style="background-color: rgba(0,0,0,0.5);" tabindex="-1">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Modifier la photo de profil</h5>
                <button type="button" class="btn-close" (click)="cancelEdit()"></button>
              </div>
              <div class="modal-body text-center">
                <img 
                  [src]="photoPreview || employe?.photoProfil || 'assets/images/LUM3.jpg'" 
                  alt="Photo de profil" 
                  class="rounded-circle mb-3"
                  style="width: 150px; height: 150px; object-fit: cover;"
                />
                <input 
                  type="file"
                  accept="image/*"
                  class="form-control mb-3"
                  (change)="onPhotoSelected($event)"
                />
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="cancelEdit()">Annuler</button>
                <button type="button" class="btn btn-primary" (click)="savePhoto()" [disabled]="!selectedPhoto || loading">
                  {{ loading ? 'Enregistrement...' : 'Enregistrer' }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="profile-summary">
        <h2 class="profile-name">{{ displayName }}</h2>
        <p class="profile-title">
          {{ employe?.domainePrincipal || 'Domaine non spécifié' }} · 
          {{ employe?.anneesExperience || 0 }} an(s) d'expérience
        </p>
        <p class="profile-meta">
          <i class="bi bi-geo-alt me-1"></i>
          {{ employe?.adresse || 'Adresse non renseignée' }}
          <span *ngIf="employe?.latitude && employe?.longitude" class="text-muted">
            · {{ employe?.latitude?.toFixed(4) }}, {{ employe?.longitude?.toFixed(4) }}
          </span>
        </p>
        <div class="profile-actions">
          <button 
            *ngIf="!editing"
            class="btn btn-primary"
            (click)="toggleEdit()"
          >
            <i class="bi bi-pencil me-1"></i>Modifier le profil
          </button>
          <button 
            *ngIf="editing"
            class="btn btn-success"
            (click)="saveProfile()"
            [disabled]="loading"
          >
            <i class="bi bi-check me-1"></i>{{ loading ? 'Enregistrement...' : 'Enregistrer' }}
          </button>
          <button 
            *ngIf="editing"
            class="btn btn-outline-secondary"
            (click)="toggleEdit()"
            [disabled]="loading"
          >
            <i class="bi bi-x me-1"></i>Annuler
          </button>
        </div>
      </div>
    </div>

    <!-- Formulaire d'édition -->
    <div *ngIf="editing" class="profile-body">
      <div class="alert alert-info">
        <i class="bi bi-info-circle me-2"></i>
        <strong>Complétez votre profil</strong> pour améliorer votre visibilité auprès des employeurs.
      </div>

      <!-- Informations personnelles -->
      <section class="profile-section">
        <h5 class="section-title">
          <i class="bi bi-person-lines-fill me-2"></i>Informations personnelles
        </h5>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Nom <span class="text-danger">*</span></label>
            <input 
              type="text" 
              [(ngModel)]="employeForm.nom" 
              class="form-control" 
              required
            />
          </div>
          <div class="col-md-6">
            <label class="form-label">Prénom <span class="text-danger">*</span></label>
            <input 
              type="text" 
              [(ngModel)]="employeForm.prenom" 
              class="form-control" 
              required
            />
          </div>
          <div class="col-md-6">
            <label class="form-label">Email <span class="text-danger">*</span></label>
            <input 
              type="email" 
              [(ngModel)]="employeForm.email" 
              class="form-control" 
              required
            />
          </div>
          <div class="col-md-6">
            <label class="form-label">Téléphone <span class="text-danger">*</span></label>
            <input 
              type="text" 
              [(ngModel)]="employeForm.telephone" 
              class="form-control" 
              required
            />
          </div>
          <div class="col-md-6">
            <label class="form-label">Nouveau mot de passe</label>
            <input 
              type="password" 
              [(ngModel)]="employeForm.password" 
              class="form-control" 
              placeholder="Laissez vide pour ne pas changer"
            />
            <small class="text-muted">Laissez vide si vous ne souhaitez pas changer votre mot de passe</small>
          </div>
        </div>
      </section>

      <!-- Informations professionnelles -->
      <section class="profile-section">
        <h5 class="section-title">
          <i class="bi bi-briefcase me-2"></i>Informations professionnelles
        </h5>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Domaine principal <span class="text-danger">*</span></label>
            <input 
              type="text" 
              [(ngModel)]="employeForm.domainePrincipal" 
              class="form-control" 
              placeholder="Ex: Informatique, Commerce, Bâtiment..."
              required
            />
          </div>
          <div class="col-md-6">
            <label class="form-label">Années d'expérience <span class="text-danger">*</span></label>
            <input 
              type="number" 
              [(ngModel)]="employeForm.anneesExperience" 
              class="form-control" 
              min="0"
              required
            />
          </div>
          <div class="col-12">
            <label class="form-label">Bio / Description professionnelle</label>
            <textarea 
              [(ngModel)]="employeForm.bio" 
              class="form-control" 
              rows="4"
              placeholder="Parlez-nous de vous, vos compétences, votre parcours..."
            ></textarea>
          </div>
          <div class="col-12">
            <label class="form-label">Documents / Certifications</label>
            <input 
              #documentInput
              type="file"
              accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
              style="display: none;"
              (change)="onDocumentSelected($event)"
            />
            <div class="d-flex align-items-center gap-2">
              <button 
                type="button" 
                class="btn btn-outline-primary"
                (click)="documentInput.click()"
              >
                <i class="bi bi-upload me-1"></i>Choisir un document
              </button>
              <span *ngIf="selectedDocument" class="text-success">
                <i class="bi bi-check-circle me-1"></i>{{ selectedDocument.name }}
              </span>
              <span *ngIf="employeForm.documentsCertifications && !selectedDocument" class="text-muted">
                <i class="bi bi-file-earmark me-1"></i>Document déjà uploadé
              </span>
            </div>
            <small class="text-muted d-block mt-2">
              Formats acceptés : PDF, DOC, DOCX, JPG, PNG (max 10 Mo)
            </small>
            <div *ngIf="documentPreview" class="mt-2">
              <a [href]="documentPreview" target="_blank" class="btn btn-sm btn-outline-info">
                <i class="bi bi-eye me-1"></i>Voir le document
              </a>
            </div>
          </div>
          <div class="col-12">
            <div class="form-check">
              <input 
                type="checkbox" 
                [(ngModel)]="employeForm.disponibilite" 
                class="form-check-input" 
                id="disponibilite"
              />
              <label class="form-check-label" for="disponibilite">
                <i class="bi bi-check-circle me-1"></i>Disponible immédiatement
              </label>
            </div>
          </div>
        </div>
      </section>

      <!-- Localisation -->
      <section class="profile-section">
        <h5 class="section-title">
          <i class="bi bi-geo-alt me-2"></i>Localisation
        </h5>
        <div class="form-group autocomplete-container">
          <label class="form-label">Adresse complète</label>
          <geoapify-geocoder-autocomplete 
            [value]="addressDisplayValue"
            [lang]="'fr'"
            [countryCodes]="['tg']"
            [limit]="5"
            [placeholder]="'Commencez à taper votre adresse'"
            (placeSelect)="onPlaceSelected($event)">
          </geoapify-geocoder-autocomplete>
          <small class="text-muted">
            <i class="bi bi-info-circle me-1"></i>Sélectionnez une adresse dans la liste pour une localisation précise
          </small>
          <div *ngIf="employeForm.latitude && employeForm.longitude" class="mt-2 text-success small">
            <i class="bi bi-check-circle-fill me-1"></i>Localisation détectée : {{ employeForm.latitude.toFixed(4) }}, {{ employeForm.longitude.toFixed(4) }}
          </div>
        </div>
      </section>
    </div>

    <!-- Affichage du profil (mode lecture) -->
    <div *ngIf="!editing" class="profile-body">
      <section class="profile-section position-relative">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="section-title mb-0">
            <i class="bi bi-person-lines-fill me-2"></i>Informations personnelles
          </h5>
          <button class="btn btn-sm btn-outline-primary" (click)="editSection('infos')" title="Modifier">
            <i class="bi bi-pencil me-1"></i>Modifier
          </button>
        </div>
        <div class="row g-3">
          <div class="col-md-6">
            <strong>Nom :</strong>
            <p>{{ employe?.nom || 'Non renseigné' }}</p>
          </div>
          <div class="col-md-6">
            <strong>Prénom :</strong>
            <p>{{ employe?.prenom || 'Non renseigné' }}</p>
          </div>
          <div class="col-md-6">
            <strong>Email :</strong>
            <p>{{ employe?.email || 'Non renseigné' }}</p>
          </div>
          <div class="col-md-6">
            <strong>Téléphone :</strong>
            <p>{{ employe?.telephone || 'Non renseigné' }}</p>
          </div>
        </div>
      </section>

      <section class="profile-section position-relative" *ngIf="employe?.adresse">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="section-title mb-0">
            <i class="bi bi-geo-alt me-2"></i>Localisation
          </h5>
          <button class="btn btn-sm btn-outline-primary" (click)="editSection('localisation')" title="Modifier">
            <i class="bi bi-pencil me-1"></i>Modifier
          </button>
        </div>
        <p class="section-text">
          <i class="bi bi-geo-alt-fill me-2"></i>{{ employe?.adresse }}
        </p>
      </section>

      <!-- Informations professionnelles avec diplômes et compétences -->
      <section class="profile-section position-relative">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="section-title mb-0">
            <i class="bi bi-briefcase me-2"></i>Informations professionnelles
          </h5>
          <button class="btn btn-sm btn-outline-primary" (click)="editSection('pro')" title="Modifier">
            <i class="bi bi-pencil me-1"></i>Modifier
          </button>
        </div>
        
        <!-- Domaine et expérience -->
        <div class="row g-3 mb-3">
          <div class="col-md-6" *ngIf="employe?.domainePrincipal">
            <strong><i class="bi bi-briefcase me-1"></i>Domaine principal :</strong>
            <p class="mb-0">{{ employe?.domainePrincipal }}</p>
          </div>
          <div class="col-md-6" *ngIf="employe?.anneesExperience !== undefined">
            <strong><i class="bi bi-calendar-check me-1"></i>Années d'expérience :</strong>
            <p class="mb-0">{{ employe?.anneesExperience }} an(s)</p>
          </div>
          <div class="col-12" *ngIf="employe?.bio">
            <strong><i class="bi bi-person-badge me-1"></i>Bio :</strong>
            <p class="mb-0">{{ employe?.bio }}</p>
          </div>
          <div class="col-12">
            <strong><i class="bi bi-check-circle me-1"></i>Disponibilité :</strong>
            <p class="mb-0">
              <span [class]="employe?.disponibilite ? 'badge bg-success' : 'badge bg-secondary'">
                {{ employe?.disponibilite ? 'Disponible immédiatement' : 'Non disponible' }}
              </span>
            </p>
          </div>
        </div>

        <!-- Diplômes -->
        <div class="mb-3">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">
              <i class="bi bi-mortarboard me-2"></i>Diplômes
            </h6>
            <button class="btn btn-sm btn-outline-primary" (click)="addDiplome()" title="Ajouter">
              <i class="bi bi-plus-circle me-1"></i>Ajouter
            </button>
          </div>
          <div *ngIf="diplomes.length === 0" class="text-muted small">
            <p class="mb-0">Aucun diplôme renseigné</p>
          </div>
          <div *ngIf="diplomes.length > 0" class="row g-2">
            <div *ngFor="let diplome of diplomes" class="col-md-6">
              <div class="card border">
                <div class="card-body p-2">
                  <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                      <h6 class="card-title mb-1 small">{{ diplome.nomDiplome || 'Diplôme' }}</h6>
                      <p class="card-text mb-1 small">
                        <i class="bi bi-building me-1"></i>{{ diplome.etablissement || 'Non spécifié' }}
                      </p>
                      <p class="card-text mb-1 small" *ngIf="diplome.niveau">
                        <i class="bi bi-award me-1"></i>Niveau : {{ getNiveauDiplomeLabel(diplome.niveau) }}
                      </p>
                      <p class="card-text mb-0 small" *ngIf="diplome.anneeObtention">
                        <i class="bi bi-calendar me-1"></i>
                        {{ diplome.anneeObtention | date:'yyyy' }}
                      </p>
                    </div>
                    <div class="btn-group-vertical btn-group-sm">
                      <button class="btn btn-outline-primary btn-sm" (click)="editDiplome(diplome)" title="Modifier">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button class="btn btn-outline-danger btn-sm" (click)="deleteDiplome(diplome.id!)" title="Supprimer">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Compétences -->
        <div>
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">
              <i class="bi bi-tools me-2"></i>Compétences
            </h6>
            <button class="btn btn-sm btn-outline-primary" (click)="addCompetence()" title="Ajouter">
              <i class="bi bi-plus-circle me-1"></i>Ajouter
            </button>
          </div>
          <div *ngIf="competences.length === 0" class="text-muted small">
            <p class="mb-0">Aucune compétence renseignée</p>
          </div>
          <div *ngIf="competences.length > 0" class="d-flex flex-wrap gap-2">
            <span *ngFor="let competence of competences" class="badge bg-primary position-relative p-2">
              {{ competence.nomCompetence }}
              <span *ngIf="competence.niveau" class="badge bg-light text-dark ms-2">
                {{ getNiveauCompetenceLabel(competence.niveau) }}
              </span>
              <button 
                class="btn btn-sm btn-link text-white p-0 ms-2" 
                (click)="editCompetence(competence)"
                title="Modifier"
                style="font-size: 0.7rem; line-height: 1;"
              >
                <i class="bi bi-pencil"></i>
              </button>
              <button 
                class="btn btn-sm btn-link text-white p-0 ms-1" 
                (click)="deleteCompetence(competence.id!)"
                title="Supprimer"
                style="font-size: 0.7rem; line-height: 1;"
              >
                <i class="bi bi-x-circle"></i>
              </button>
            </span>
          </div>
        </div>
      </section>

      <!-- CV -->
      <section class="profile-section position-relative">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="section-title mb-0">
            <i class="bi bi-file-earmark-pdf me-2"></i>Curriculum Vitae (CV)
          </h5>
          <button class="btn btn-sm btn-outline-primary" (click)="editSection('cv')" title="Ajouter/Modifier">
            <i class="bi bi-plus-circle me-1"></i>{{ cvDocuments.length > 0 ? 'Modifier' : 'Ajouter' }}
          </button>
        </div>
        <div *ngIf="cvDocuments.length === 0" class="text-muted">
          <p>Aucun CV uploadé</p>
        </div>
        <div *ngIf="cvDocuments.length > 0" class="row g-2">
          <div *ngFor="let cv of cvDocuments" class="col-12">
            <div class="card border">
              <div class="card-body p-2">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <i class="bi bi-file-earmark-pdf me-2 text-danger"></i>
                    <strong>{{ cv.typeDocument }}</strong>
                    <small class="text-muted ms-2">
                      Uploadé le {{ cv.dateSoumission | date:'dd/MM/yyyy' }}
                    </small>
                  </div>
                  <div class="btn-group btn-group-sm">
                    <a 
                      [href]="cv.cheminFichier" 
                      target="_blank" 
                      class="btn btn-outline-primary btn-sm"
                      title="Télécharger"
                    >
                      <i class="bi bi-download"></i>
                    </a>
                    <button 
                      class="btn btn-outline-danger btn-sm" 
                      (click)="deleteCv(cv.trackingId)"
                      title="Supprimer"
                    >
                      <i class="bi bi-trash"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Documents -->
      <section class="profile-section position-relative" *ngIf="employe?.documentsCertifications">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="section-title mb-0">
            <i class="bi bi-file-earmark me-2"></i>Documents / Certifications
          </h5>
          <button class="btn btn-sm btn-outline-primary" (click)="editSection('document')" title="Modifier">
            <i class="bi bi-pencil me-1"></i>Modifier
          </button>
        </div>
        <div>
          <a [href]="employe?.documentsCertifications" target="_blank" class="btn btn-outline-primary">
            <i class="bi bi-download me-1"></i>Télécharger le document
          </a>
        </div>
      </section>
    </div>
  </div>
</div>

<!-- Modals pour l'édition des sections -->
<!-- Modal Informations personnelles -->
<div *ngIf="editingSection === 'infos'" class="modal fade show d-block" style="background-color: rgba(0,0,0,0.5);" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Modifier les informations personnelles</h5>
        <button type="button" class="btn-close" (click)="cancelEdit()"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Nom <span class="text-danger">*</span></label>
            <input type="text" [(ngModel)]="employeForm.nom" class="form-control" required />
          </div>
          <div class="col-md-6">
            <label class="form-label">Prénom <span class="text-danger">*</span></label>
            <input type="text" [(ngModel)]="employeForm.prenom" class="form-control" required />
          </div>
          <div class="col-md-6">
            <label class="form-label">Email <span class="text-danger">*</span></label>
            <input type="email" [(ngModel)]="employeForm.email" class="form-control" required />
          </div>
          <div class="col-md-6">
            <label class="form-label">Téléphone <span class="text-danger">*</span></label>
            <input type="text" [(ngModel)]="employeForm.telephone" class="form-control" required />
          </div>
          <div class="col-12">
            <label class="form-label">Nouveau mot de passe</label>
            <input type="password" [(ngModel)]="employeForm.password" class="form-control" placeholder="Laissez vide pour ne pas changer" />
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cancelEdit()">Annuler</button>
        <button type="button" class="btn btn-primary" (click)="saveSection('infos')" [disabled]="loading">
          {{ loading ? 'Enregistrement...' : 'Enregistrer' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Informations professionnelles -->
<div *ngIf="editingSection === 'pro'" class="modal fade show d-block" style="background-color: rgba(0,0,0,0.5);" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Modifier les informations professionnelles</h5>
        <button type="button" class="btn-close" (click)="cancelEdit()"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Domaine principal <span class="text-danger">*</span></label>
            <input type="text" [(ngModel)]="employeForm.domainePrincipal" class="form-control" required />
          </div>
          <div class="col-md-6">
            <label class="form-label">Années d'expérience <span class="text-danger">*</span></label>
            <input type="number" [(ngModel)]="employeForm.anneesExperience" class="form-control" min="0" required />
          </div>
          <div class="col-12">
            <label class="form-label">Bio / Description</label>
            <textarea [(ngModel)]="employeForm.bio" class="form-control" rows="4"></textarea>
          </div>
          <div class="col-12">
            <label class="form-label">Documents / Certifications</label>
            <input type="text" [(ngModel)]="employeForm.documentsCertifications" class="form-control" />
          </div>
          <div class="col-12">
            <div class="form-check">
              <input type="checkbox" [(ngModel)]="employeForm.disponibilite" class="form-check-input" id="disponibilite" />
              <label class="form-check-label" for="disponibilite">Disponible immédiatement</label>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cancelEdit()">Annuler</button>
        <button type="button" class="btn btn-primary" (click)="saveSection('pro')" [disabled]="loading">
          {{ loading ? 'Enregistrement...' : 'Enregistrer' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Localisation -->
<div *ngIf="editingSection === 'localisation'" class="modal fade show d-block" style="background-color: rgba(0,0,0,0.5);" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Modifier la localisation</h5>
        <button type="button" class="btn-close" (click)="cancelEdit()"></button>
      </div>
      <div class="modal-body">
        <div class="form-group autocomplete-container">
          <label class="form-label">Adresse complète</label>
          <geoapify-geocoder-autocomplete 
            [value]="addressDisplayValue"
            [lang]="'fr'"
            [countryCodes]="['tg']"
            [limit]="5"
            [placeholder]="'Commencez à taper votre adresse'"
            (placeSelect)="onPlaceSelected($event)">
          </geoapify-geocoder-autocomplete>
          <div *ngIf="employeForm.latitude && employeForm.longitude" class="mt-2 text-success small">
            <i class="bi bi-check-circle-fill me-1"></i>Localisation détectée : {{ employeForm.latitude.toFixed(4) }}, {{ employeForm.longitude.toFixed(4) }}
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cancelEdit()">Annuler</button>
        <button type="button" class="btn btn-primary" (click)="saveSection('localisation')" [disabled]="loading">
          {{ loading ? 'Enregistrement...' : 'Enregistrer' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Document -->
<div *ngIf="editingSection === 'document'" class="modal fade show d-block" style="background-color: rgba(0,0,0,0.5);" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Modifier le document</h5>
        <button type="button" class="btn-close" (click)="cancelEdit()"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">Document / Certification</label>
          <input 
            #documentInput
            type="file"
            accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
            class="form-control"
            (change)="onDocumentSelected($event)"
          />
          <small class="text-muted">Formats acceptés : PDF, DOC, DOCX, JPG, PNG (max 10 Mo)</small>
          <div *ngIf="documentPreview" class="mt-2">
            <a [href]="documentPreview" target="_blank" class="btn btn-sm btn-outline-info">
              <i class="bi bi-eye me-1"></i>Voir le document
            </a>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cancelEdit()">Annuler</button>
        <button type="button" class="btn btn-primary" (click)="saveDocument()" [disabled]="!selectedDocument || loading">
          {{ loading ? 'Enregistrement...' : 'Enregistrer' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Diplômes -->
<div *ngIf="editingSection === 'diplomes' && editingDiplome" class="modal fade show d-block" style="background-color: rgba(0,0,0,0.5);" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ editingDiplome.id ? 'Modifier le diplôme' : 'Ajouter un diplôme' }}</h5>
        <button type="button" class="btn-close" (click)="editingDiplome = null; editingSection = null"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <div class="col-12">
            <label class="form-label">Nom du diplôme <span class="text-danger">*</span></label>
            <input 
              type="text" 
              [(ngModel)]="editingDiplome.nomDiplome" 
              class="form-control" 
              placeholder="Ex: Master en architecture"
              required
            />
          </div>
          <div class="col-md-6">
            <label class="form-label">Niveau <span class="text-danger">*</span></label>
            <select [(ngModel)]="editingDiplome.niveau" class="form-control" required>
              <option *ngFor="let niveau of niveauDiplomeOptions" [value]="niveau">
                {{ niveauDiplomeLabels[niveau] }}
              </option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">Établissement <span class="text-danger">*</span></label>
            <input 
              type="text" 
              [(ngModel)]="editingDiplome.etablissement" 
              class="form-control" 
              placeholder="Ex: EAMAU"
              required
            />
          </div>
          <div class="col-12">
            <label class="form-label">Année d'obtention</label>
            <input 
              type="text" 
              [(ngModel)]="editingDiplome.anneeObtention" 
              class="form-control" 
              placeholder="Ex: 2022"
            />
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="editingDiplome = null; editingSection = null">Annuler</button>
        <button type="button" class="btn btn-primary" (click)="saveDiplome()" [disabled]="loading">
          {{ loading ? 'Enregistrement...' : 'Enregistrer' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Compétences -->
<div *ngIf="editingSection === 'competences' && editingCompetence" class="modal fade show d-block" style="background-color: rgba(0,0,0,0.5);" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ editingCompetence.id ? 'Modifier la compétence' : 'Ajouter une compétence' }}</h5>
        <button type="button" class="btn-close" (click)="editingCompetence = null; editingSection = null"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <div class="col-md-8">
            <label class="form-label">Nom de la compétence <span class="text-danger">*</span></label>
            <input 
              type="text" 
              [(ngModel)]="editingCompetence.nomCompetence" 
              class="form-control" 
              placeholder="Ex: Grate Ciel"
              required
            />
          </div>
          <div class="col-md-4">
            <label class="form-label">Niveau <span class="text-danger">*</span></label>
            <select [(ngModel)]="editingCompetence.niveau" class="form-control" required>
              <option *ngFor="let niveau of niveauCompetenceOptions" [value]="niveau">
                {{ niveauCompetenceLabels[niveau] }}
              </option>
            </select>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="editingCompetence = null; editingSection = null">Annuler</button>
        <button type="button" class="btn btn-primary" (click)="saveCompetence()" [disabled]="loading">
          {{ loading ? 'Enregistrement...' : 'Enregistrer' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal CV -->
<div *ngIf="editingSection === 'cv'" class="modal fade show d-block" style="background-color: rgba(0,0,0,0.5);" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Uploader un CV</h5>
        <button type="button" class="btn-close" (click)="cancelEdit()"></button>
      </div>
      <div class="modal-body">
        <!-- Zone de drag & drop -->
        <div 
          class="border rounded p-5 text-center"
          [class.bg-light]="!isDragging"
          [class.border-primary]="isDragging"
          [class.bg-primary]="isDragging"
          [class.text-white]="isDragging"
          (dragover)="onDragOver($event)"
          (dragleave)="onDragLeave($event)"
          (drop)="onDrop($event)"
          style="cursor: pointer; transition: all 0.3s;"
        >
          <input 
            #cvInput
            type="file"
            accept=".pdf,.doc,.docx"
            style="display: none;"
            (change)="onCvFileSelected($event)"
          />
          <div *ngIf="!selectedCv">
            <i class="bi bi-cloud-upload" style="font-size: 3rem;"></i>
            <p class="mt-3 mb-0">
              <strong>Glissez-déposez votre CV ici</strong>
            </p>
            <p class="text-muted small">ou</p>
            <button 
              type="button" 
              class="btn btn-primary"
              (click)="cvInput.click()"
            >
              <i class="bi bi-folder2-open me-1"></i>Choisir un fichier
            </button>
            <p class="text-muted small mt-2 mb-0">
              Formats acceptés : PDF, DOC, DOCX (max 10 Mo)
            </p>
          </div>
          <div *ngIf="selectedCv" class="text-success">
            <i class="bi bi-check-circle-fill" style="font-size: 3rem;"></i>
            <p class="mt-3 mb-0">
              <strong>{{ selectedCv.name }}</strong>
            </p>
            <p class="text-muted small">
              Taille : {{ (selectedCv.size / 1024 / 1024).toFixed(2) }} Mo
            </p>
            <button 
              type="button" 
              class="btn btn-outline-secondary btn-sm mt-2"
              (click)="selectedCv = null; cvInput.value = ''"
            >
              <i class="bi bi-x-circle me-1"></i>Changer de fichier
            </button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cancelEdit()">Annuler</button>
        <button type="button" class="btn btn-primary" (click)="uploadCv()" [disabled]="!selectedCv || loading">
          {{ loading ? 'Upload en cours...' : 'Uploader' }}
        </button>
      </div>
    </div>
  </div>
</div>

 